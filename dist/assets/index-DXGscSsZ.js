import ue from"html2canvas";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();let p=[],r=[],d=[],y=["Conveyor","Pump","Pipe","Motor","Valve","Sensor"],g=["Trip","Power Failure","Run Skew","Conveyor Torn","Rollers Damaged","Leakage","Blockage","Wear","Failure","Scheduled Maintenance"],b=[{name:"mechanical",color:"#FF9AA2"},{name:"electrical",color:"#FFB7B2"},{name:"operations",color:"#FFDAC1"},{name:"technicians",color:"#E2F0CB"},{name:"instrumentation",color:"#B5EAD7"},{name:"management",color:"#C7CEEA"}],m=[],k="",I=null,M="24h";document.addEventListener("DOMContentLoaded",function(){me(),pe(),L("equipment-rows",!0),ee(),A(),te(),w(),$(),R(),f(),S(),ne("tracker")});function me(){document.addEventListener("mouseup",we),document.getElementById("timeline-view-select").addEventListener("change",ye),document.querySelector(".tabs").addEventListener("click",e=>{e.target.classList.contains("tab")&&ne(e.target.dataset.tab)}),document.querySelector(".admin-tabs").addEventListener("click",e=>{e.target.classList.contains("admin-tab")&&O(e.target.dataset.adminTab)}),document.getElementById("equipment-select").addEventListener("change",e=>W(e.target.value)),document.getElementById("cancel-booking-btn").addEventListener("click",le),document.getElementById("save-booking-btn").addEventListener("click",Ie),document.querySelector(".system-icons").addEventListener("click",e=>{e.target.classList.contains("system-icon")&&Be(e.target,e.target.dataset.system)}),document.getElementById("export-jpg-btn").addEventListener("click",Oe),document.getElementById("export-txt-btn").addEventListener("click",He),document.getElementById("clear-all-btn").addEventListener("click",Pe),document.getElementById("search-relations").addEventListener("input",f),document.getElementById("filter-equipment").addEventListener("change",f),document.getElementById("filter-section").addEventListener("change",f),document.getElementById("export-relations-btn").addEventListener("click",Ne),document.getElementById("import-relations-btn").addEventListener("click",De),document.getElementById("add-new-relation-btn").addEventListener("click",$e),document.getElementById("relations-grid-body").addEventListener("click",e=>{var o;const t=e.target.closest("button");if(!t)return;const n=(o=t.closest(".relation-grid-row"))==null?void 0:o.dataset.relationId;t.classList.contains("btn-edit-grid")&&xe(n),t.classList.contains("btn-delete-grid")&&Ae(n)}),document.getElementById("add-equipment-btn").addEventListener("click",ve),document.getElementById("add-system-btn").addEventListener("click",ie),document.getElementById("add-fault-btn").addEventListener("click",se),document.getElementById("admin-equipment-list").addEventListener("click",e=>H(e,"equipment","deleteEquipmentItem")),document.getElementById("admin-systems-list").addEventListener("click",e=>H(e,"system","deleteSystemType")),document.getElementById("admin-faults-list").addEventListener("click",e=>H(e,"fault","deleteFaultType")),document.getElementById("builder-equipment").addEventListener("change",q),document.getElementById("builder-section").addEventListener("change",q),document.querySelector(".systems-grid").addEventListener("change",q),document.querySelector(".faults-grid").addEventListener("change",q),document.getElementById("add-custom-system-btn").addEventListener("click",Fe),document.getElementById("add-custom-fault-btn").addEventListener("click",Me),document.getElementById("clear-builder-btn").addEventListener("click",K),document.getElementById("save-relation-btn").addEventListener("click",Ce)}function H(e,t,n){const o=e.target.closest("button");if(!o)return;const s=e.target.closest(".admin-list-item"),i=Array.from(s.parentNode.children).indexOf(s);o.dataset.action==="edit"?ge(t,i):o.dataset.action==="delete"?{deleteEquipmentItem:Ee,deleteSystemType:he,deleteFaultType:qe}[n](i):o.dataset.action==="save"?oe(t,i):o.dataset.action==="cancel"&&z()}function v(){const e={bookings:p,equipmentRelations:r,equipmentList:d,systemTypes:y,faultTypes:g,sections:b};localStorage.setItem("equipmentUtilizationData",JSON.stringify(e)),console.log("Data saved.")}function pe(){const e=localStorage.getItem("equipmentUtilizationData");if(e)try{const t=JSON.parse(e);p=t.bookings||[],r=t.equipmentRelations||[],d=t.equipmentList||[],y=t.systemTypes||["Conveyor","Pump","Pipe","Motor","Valve","Sensor"],g=t.faultTypes||["Trip","Power Failure","Run Skew","Conveyor Torn","Rollers Damaged","Leakage","Blockage","Wear","Failure","Scheduled Maintenance"],b=t.sections||[{name:"mechanical",color:"#FF9AA2"},{name:"electrical",color:"#FFB7B2"},{name:"operations",color:"#FFDAC1"},{name:"technicians",color:"#E2F0CB"},{name:"instrumentation",color:"#B5EAD7"},{name:"management",color:"#C7CEEA"}]}catch(t){console.error("Error parsing data from localStorage",t)}}function L(e,t){const n=document.getElementById(e);n.innerHTML="",d.forEach(o=>{const s=fe(o,t);n.appendChild(s)}),_(e)}function _(e){const t=document.getElementById(e);t&&(t.querySelectorAll(".time-block.booked").forEach(n=>{n.classList.remove("booked"),n.style.backgroundColor="",delete n.dataset.bookingId}),t.querySelectorAll(".booking-summary").forEach(n=>n.remove()),p.forEach(n=>{const o=t.querySelector(`[data-equipment="${n.equipment}"]`);if(!o)return;const s=n.shift==="day"?o.nextElementSibling:o.nextElementSibling.nextElementSibling,i=s==null?void 0:s.querySelector(".time-blocks");i&&(e==="equipment-rows"&&n.timeBlocks.forEach(l=>{const a=i.querySelector(`[data-index='${l.index}']`);a&&(a.classList.add("booked"),a.dataset.bookingId=n.id,a.style.backgroundColor=Q(n.section))}),e==="meeting-equipment-rows"&&Re(n,i))}))}function ee(){_("equipment-rows")}function fe(e,t){const n=document.createElement("div");n.className="equipment-row";const o=document.createElement("div");o.className="equipment-label",o.textContent=e,o.dataset.equipment=e.toLowerCase().replace(/\s+/g,"-"),n.appendChild(o);const s=Z("Day Shift (6:00-18:00)",6,18,e,t,"day");n.appendChild(s);const i=Z("Night Shift (18:00-6:00)",18,30,e,t,"night");return n.appendChild(i),n}function Z(e,t,n,o,s,i){const l=document.createElement("div");l.className="shift-section",l.dataset.shift=i;const a=document.createElement("div");a.className="shift-header",a.textContent=e,l.appendChild(a);const c=document.createElement("div");c.className="time-header";const u=document.createElement("div");u.className="time-blocks";let E=0;for(let T=t;T<t+12;T++){const Y=T>=24?T-24:T;for(let x=0;x<60;x+=5){const F=document.createElement("div");F.className="time-slot",x===0&&(F.textContent=`${Y.toString().padStart(2,"0")}:00`,F.classList.add("hour-mark")),c.appendChild(F);const h=document.createElement("div");h.className="time-block",x===0&&h.classList.add("hour-start"),h.dataset.index=E,h.dataset.time=`${Y.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`,h.dataset.equipment=o.toLowerCase().replace(/\s+/g,"-"),s?(h.addEventListener("mousedown",be),h.addEventListener("mouseenter",Le)):h.style.cursor="default",u.appendChild(h),E++}}return l.appendChild(c),l.appendChild(u),l}function P(e){var s;const t=document.getElementById(e);if(!t)return;const n=t.value,o=(s=t.querySelector('option[value=""]'))==null?void 0:s.textContent.toLowerCase().includes("all");t.innerHTML=o?'<option value="">All Equipment</option>':'<option value="">Select Equipment</option>',d.forEach(i=>{const l=i.toLowerCase().replace(/\s+/g,"-"),a=document.createElement("option");a.value=l,a.textContent=i,t.appendChild(a)}),Array.from(t.options).some(i=>i.value===n)&&(t.value=n)}function te(){document.querySelectorAll("#filter-section, #builder-section, #section-select").forEach(t=>{const n=t.value,o=t.id==="filter-section";t.innerHTML=o?'<option value="">All Sections</option>':'<option value="">Select Section</option>',b.forEach(s=>{const i=document.createElement("option");i.value=s.name,i.textContent=s.name.charAt(0).toUpperCase()+s.name.slice(1),t.appendChild(i)}),Array.from(t.options).some(s=>s.value===n)&&(t.value=n)})}function A(){P("equipment-select"),P("builder-equipment"),P("filter-equipment")}function w(){const e=(t,n,o)=>{t.innerHTML="",n.forEach(s=>{const i=`${o}-${s.toLowerCase().replace(/\s+/g,"-")}`,l=document.createElement("div");l.className=`${o}-item`,l.innerHTML=`<input type="checkbox" id="${i}" value="${s}"><label for="${i}">${s}</label>`,t.appendChild(l)})};e(document.querySelector(".systems-grid"),y,"sys"),e(document.querySelector(".faults-grid"),g,"fault")}function $(){V(),G(),J()}function U(e,t,n,o){const s=document.getElementById(e);if(s.innerHTML="",t.length===0){s.innerHTML='<p style="padding: 10px; color: #7f8c8d;">No items yet.</p>';return}t.forEach((i,l)=>{const a=document.createElement("div");if(a.className="admin-list-item",I&&I.type===n&&I.index===l){a.innerHTML=`
                        <input type="text" id="edit-input-${n}" value="${i}" class="admin-item-input">
                        <div class="admin-item-actions">
                            <button class="btn-grid btn-primary" data-action="save">Save</button>
                            <button class="btn-grid btn-secondary" data-action="cancel">Cancel</button>
                        </div>
                    `;const c=a.querySelector("input");setTimeout(()=>c==null?void 0:c.focus(),0),c.addEventListener("keydown",u=>{u.key==="Enter"&&oe(n,l),u.key==="Escape"&&z()})}else a.innerHTML=`
                        <span class="admin-item-name">${i}</span>
                        <div class="admin-item-actions">
                            <button class="btn-grid btn-edit-grid" data-action="edit">Edit</button>
                            <button class="btn-grid btn-delete-grid" data-action="delete">Delete</button>
                        </div>
                    `;s.appendChild(a)})}function V(){U("admin-equipment-list",d,"equipment")}function G(){U("admin-systems-list",y,"system")}function J(){U("admin-faults-list",g,"fault")}function f(){const e=document.getElementById("relations-grid-body"),t=document.getElementById("search-relations").value.toLowerCase(),n=document.getElementById("filter-equipment").value,o=document.getElementById("filter-section").value,s=r.filter(i=>{const l=`${i.equipment} ${i.systems.join(" ")} ${i.section} ${i.faults.join(" ")}`.toLowerCase(),a=!t||l.includes(t),c=!n||i.equipment===n,u=!o||i.section===o;return a&&c&&u});if(s.length===0){e.innerHTML='<div class="no-relations">No relations found matching your criteria.</div>';return}e.innerHTML="",s.forEach(i=>{const l=d.find(c=>c.toLowerCase().replace(/\s+/g,"-")===i.equipment)||i.equipment,a=document.createElement("div");a.className="relation-grid-row",a.dataset.relationId=i.id,a.innerHTML=`
                    <div class="grid-cell"><div class="equipment-badge">${l}</div></div>
                    <div class="grid-cell"><div class="systems-list">${i.systems.map(c=>`<span class="system-tag">${c}</span>`).join("")}</div></div>
                    <div class="grid-cell"><div class="section-badge" style="background-color: ${Q(i.section)}">${i.section.charAt(0).toUpperCase()+i.section.slice(1)}</div></div>
                    <div class="grid-cell"><div class="faults-list">${i.faults.map(c=>`<span class="fault-tag">${c}</span>`).join("")}</div></div>
                    <div class="grid-cell"><div class="relation-actions-grid">
                        <button class="btn-grid btn-edit-grid">Edit</button>
                        <button class="btn-grid btn-delete-grid">Delete</button>
                    </div></div>
                `,e.appendChild(a)})}function S(){document.getElementById("total-relations").textContent=r.length,document.getElementById("total-equipment").textContent=d.length,document.getElementById("total-sections").textContent=b.length}function ye(){M=document.getElementById("timeline-view-select").value,document.querySelectorAll(".equipment-row").forEach(n=>{const o=n.querySelector('.shift-section[data-shift="day"]'),s=n.querySelector('.shift-section[data-shift="night"]');o.classList.remove("shift-hidden","shift-full-width"),s.classList.remove("shift-hidden","shift-full-width"),M==="day"?(s.classList.add("shift-hidden"),o.classList.add("shift-full-width")):M==="night"&&(o.classList.add("shift-hidden"),s.classList.add("shift-full-width"))});const t=document.getElementById("tracker").querySelector(".timeline-container");M==="24h"?t.classList.remove("single-shift-view"):t.classList.add("single-shift-view")}function q(){const e=document.getElementById("builder-equipment").value,t=document.getElementById("builder-section").value,n=Array.from(document.querySelectorAll(".systems-grid input:checked")).map(l=>l.value),o=Array.from(document.querySelectorAll(".faults-grid input:checked")).map(l=>l.value),s=document.getElementById("builder-preview-content");if(!e&&!t&&n.length===0&&o.length===0){s.innerHTML="<p>Select equipment and configuration to see preview</p>";return}const i=d.find(l=>l.toLowerCase().replace(/\s+/g,"-")===e)||"Not selected";s.innerHTML=`
                <div class="preview-item"><span class="preview-label">Equipment:</span> <span class="preview-value">${i}</span></div>
                <div class="preview-item"><span class="preview-label">Section:</span> <span class="preview-value">${t||"Not selected"}</span></div>
                <div class="preview-item"><span class="preview-label">Systems:</span> <span class="preview-value">${n.join(", ")||"None"}</span></div>
                <div class="preview-item"><span class="preview-label">Faults:</span> <span class="preview-value">${o.join(", ")||"None"}</span></div>
            `}function ne(e){var t,n;document.querySelectorAll(".view").forEach(o=>o.classList.remove("active")),document.querySelectorAll(".tab").forEach(o=>o.classList.remove("active")),(t=document.getElementById(e))==null||t.classList.add("active"),(n=document.querySelector(`.tab[data-tab='${e}']`))==null||n.classList.add("active"),e==="meeting"&&B(),e==="admin"&&(f(),S())}function O(e){var t,n;document.querySelectorAll(".admin-view").forEach(o=>o.classList.remove("active")),document.querySelectorAll(".admin-tab").forEach(o=>o.classList.remove("active")),(t=document.getElementById(`admin-${e}-view`))==null||t.classList.add("active"),(n=document.querySelector(`.admin-tab[data-admin-tab='${e}']`))==null||n.classList.add("active"),e==="manager"&&f()}function ge(e,t){I={type:e,index:t},$()}function z(){I=null,$()}function oe(e,t){const n=document.getElementById(`edit-input-${e}`);if(!n)return;const o=n.value.trim();let s,i;if(e==="equipment"?s=d:e==="system"?s=y:s=g,i=s[t],!o){alert(`The ${e} name cannot be empty.`);return}if(o.toLowerCase()!==i.toLowerCase()&&s.find(l=>l.toLowerCase()===o.toLowerCase())){alert(`This ${e} name already exists.`);return}if(o===i){z();return}if(e==="equipment"){const l=i.toLowerCase().replace(/\s+/g,"-"),a=o.toLowerCase().replace(/\s+/g,"-");s[t]=o,r.forEach(c=>{c.equipment===l&&(c.equipment=a)}),p.forEach(c=>{c.equipment===l&&(c.equipment=a)})}else e==="system"?(s[t]=o,r.forEach(l=>{const a=l.systems.findIndex(c=>c.toLowerCase()===i.toLowerCase());a>-1&&(l.systems[a]=o)})):(s[t]=o,r.forEach(l=>{const a=l.faults.findIndex(c=>c.toLowerCase()===i.toLowerCase());a>-1&&(l.faults[a]=o)}));s.sort(),I=null,$(),w(),f(),e==="equipment"&&(A(),L("equipment-rows",!0),B()),v()}function ve(){const e=document.getElementById("new-equipment-name"),t=e.value.trim();t&&!d.find(n=>n.toLowerCase()===t.toLowerCase())?(d.push(t),d.sort(),V(),A(),L("equipment-rows",!0),B(),S(),e.value="",v()):alert(t?"This equipment already exists.":"Please enter an equipment name.")}function Ee(e){const t=d[e];if(confirm(`Are you sure you want to delete "${t}"? This will also remove any relations and bookings associated with it.`)){const n=t.toLowerCase().replace(/\s+/g,"-");d.splice(e,1),r=r.filter(o=>o.equipment!==n),p=p.filter(o=>o.equipment!==n),V(),A(),L("equipment-rows",!0),B(),f(),S(),v()}}function ie(){const e=document.getElementById("new-system-name"),t=e.value.trim();return t&&!y.find(n=>n.toLowerCase()===t.toLowerCase())?(y.push(t),y.sort(),G(),w(),e.value="",v(),t):(alert(t?"This system type already exists.":"Please enter a system type name."),null)}function he(e){const t=y[e];confirm(`Are you sure you want to delete system type "${t}"? It will be removed from all relations.`)&&(y.splice(e,1),r.forEach(n=>{n.systems=n.systems.filter(o=>o.toLowerCase()!==t.toLowerCase())}),G(),w(),f(),v())}function se(){const e=document.getElementById("new-fault-name"),t=e.value.trim();return t&&!g.find(n=>n.toLowerCase()===t.toLowerCase())?(g.push(t),g.sort(),J(),w(),e.value="",v(),t):(alert(t?"This fault type already exists.":"Please enter a fault type name."),null)}function qe(e){const t=g[e];confirm(`Are you sure you want to delete fault type "${t}"? It will be removed from all relations.`)&&(g.splice(e,1),r.forEach(n=>{n.faults=n.faults.filter(o=>o.toLowerCase()!==t.toLowerCase())}),J(),w(),f(),v())}let N=!1,j=-1,C="";function be(e){if(e.button!==0)return;const t=e.target.closest(".time-block");if(t){if(t.classList.contains("booked")){ae(t.dataset.bookingId);return}N=!0,j=parseInt(t.dataset.index),C=t.dataset.equipment,document.querySelectorAll(".time-block.selected").forEach(n=>n.classList.remove("selected")),m=[{element:t,index:j,equipment:C,time:t.dataset.time}],t.classList.add("selected"),re(),e.preventDefault()}}function Le(e){if(!N)return;const t=e.target.closest(".time-block");if(!t||t.classList.contains("booked")||t.dataset.equipment!==C)return;const n=t.closest(".shift-section"),o=Array.from(n.querySelectorAll(".time-block"));o.forEach(u=>u.classList.remove("selected")),m=[];const s=o.find(u=>parseInt(u.dataset.index)===j);if(!s)return;const i=o.indexOf(s),l=o.indexOf(t),[a,c]=[Math.min(i,l),Math.max(i,l)];for(let u=a;u<=c;u++){const E=o[u];E&&!E.classList.contains("booked")&&(E.classList.add("selected"),m.push({element:E,index:parseInt(E.dataset.index),equipment:C,time:E.dataset.time}))}re()}function we(){N&&(N=!1,m.length>0?Se():de())}function Se(){if(ce(),document.getElementById("modal-overlay").style.display="block",document.getElementById("booking-modal").style.display="block",m.length>0){const e=m[0].equipment;document.getElementById("equipment-select").value=e,W(e)}}function le(){document.getElementById("modal-overlay").style.display="none",document.getElementById("booking-modal").style.display="none",document.querySelectorAll(".time-block.selected").forEach(e=>e.classList.remove("selected")),m=[],de()}function Be(e,t){document.querySelectorAll(".system-icon").forEach(n=>n.classList.remove("selected")),e.classList.add("selected"),k=t}function Ie(){const e=document.getElementById("equipment-select").value,t=document.getElementById("section-select").value,n=document.getElementById("fault-select").value;if(!e||!t||!n||!k){alert("Please fill in all required fields");return}m.sort((i,l)=>i.time.localeCompare(l.time));const o=m[0].element.closest(".shift-section").querySelector(".shift-header").textContent.includes("Day")?"day":"night",s={id:Date.now().toString(),equipment:e,system:k,section:t,fault:n,comments:document.getElementById("comments").value,timeBlocks:m.map(i=>({index:i.index,time:i.time})),startTime:m[0].time,endTime:m[m.length-1].time,shift:o};p.push(s),le(),ee(),document.getElementById("meeting").classList.contains("active")&&B(),v()}function ae(e){const t=p.find(o=>o.id===e);if(!t)return;ce(),document.getElementById("booking-modal-title").textContent="Booking Details",document.getElementById("equipment-select").value=t.equipment,W(t.equipment,t),document.getElementById("section-select").value=t.section,document.getElementById("fault-select").value=t.fault,document.getElementById("comments").value=t.comments,document.querySelectorAll("#booking-modal select, #booking-modal textarea").forEach(o=>o.disabled=!0),document.querySelectorAll(".system-icon").forEach(o=>o.style.pointerEvents="none");const n=document.getElementById("save-booking-btn");n.style.display="none",document.getElementById("cancel-booking-btn").textContent="Close",document.getElementById("modal-overlay").style.display="block",document.getElementById("booking-modal").style.display="block"}function ce(){document.getElementById("booking-modal-title").textContent="Add Equipment Booking";const e=document.getElementById("booking-modal");e.querySelectorAll("select, textarea").forEach(t=>{t.disabled=!1,t.tagName!=="SELECT"&&(t.value="")}),e.querySelector("#equipment-select").value="",document.querySelectorAll(".system-icon").forEach(t=>t.style.pointerEvents="auto"),R(),document.getElementById("save-booking-btn").style.display="inline-block",document.getElementById("cancel-booking-btn").textContent="Cancel"}function W(e,t=null){if(!e){R();return}const n=r.filter(l=>l.equipment===e);if(n.length===0){R();return}const o=[...new Set(n.flatMap(l=>l.systems))],s=[...new Set(n.map(l=>l.section))],i=[...new Set(n.flatMap(l=>l.faults))];ke(o,t),D("section-select",s,"Section"),D("fault-select",i,"Fault")}function ke(e,t){const n=document.querySelector(".system-icons");if(n.innerHTML="",k="",e.length===0)return;let o=t?t.system:e[0].toLowerCase().replace(/\s+/g,"-");e.forEach(s=>{const i=s.toLowerCase().replace(/\s+/g,"-"),l=document.createElement("div");l.className="system-icon",l.dataset.system=i,l.textContent=s,i===o&&(l.classList.add("selected"),k=i),n.appendChild(l)})}function D(e,t,n){const o=document.getElementById(e);o.innerHTML=`<option value="">Select ${n}</option>`,t.forEach(s=>{const i=document.createElement("option"),l=s.toLowerCase().replace(/\s+/g,"-");i.value=l,i.textContent=s.charAt(0).toUpperCase()+s.slice(1),o.appendChild(i)})}function R(){document.querySelector(".system-icons").innerHTML='<p style="color: #7f8c8d; font-size: 12px;">Select equipment to see options.</p>',k="",D("section-select",[],"Section"),D("fault-select",[],"Fault")}function Ce(){const e=document.getElementById("builder-equipment").value,t=document.getElementById("builder-section").value,n=Array.from(document.querySelectorAll(".systems-grid input:checked")).map(i=>i.value),o=Array.from(document.querySelectorAll(".faults-grid input:checked")).map(i=>i.value);if(!e||!t||n.length===0||o.length===0){alert("Please fill all fields and select at least one system and fault.");return}const s=document.getElementById("builder-equipment").dataset.editingId;if(s){const i=r.findIndex(l=>l.id===s);i!==-1&&(r[i]={...r[i],equipment:e,section:t,systems:n,faults:o})}else r.push({id:Date.now().toString(),equipment:e,section:t,systems:n,faults:o});alert(`Relation ${s?"updated":"created"} successfully`),K(),f(),S(),O("manager"),v()}function K(){document.getElementById("builder-equipment").value="",document.getElementById("builder-section").value="",document.querySelectorAll(".systems-grid input, .faults-grid input").forEach(e=>e.checked=!1),delete document.getElementById("builder-equipment").dataset.editingId,q()}function Te(e){document.getElementById("builder-equipment").value=e.equipment,document.getElementById("builder-section").value=e.section,document.querySelectorAll(".systems-grid input, .faults-grid input").forEach(t=>t.checked=!1),e.systems.forEach(t=>{const n=document.querySelector(`.systems-grid input[value="${t}"]`);n&&(n.checked=!0)}),e.faults.forEach(t=>{const n=document.querySelector(`.faults-grid input[value="${t}"]`);n&&(n.checked=!0)}),document.getElementById("builder-equipment").dataset.editingId=e.id,q()}function xe(e){const t=r.find(n=>n.id===e);t&&(Te(t),O("builder"))}function Ae(e){confirm("Are you sure you want to delete this relation?")&&(r=r.filter(t=>t.id!==e),f(),S(),v())}function $e(){K(),O("builder")}function Fe(){const e=document.getElementById("custom-system"),t=ie();if(t){const n=document.querySelector(`.systems-grid input[value="${t}"]`);n&&(n.checked=!0),q()}e.value=""}function Me(){const e=document.getElementById("custom-fault"),t=se();if(t){const n=document.querySelector(`.faults-grid input[value="${t}"]`);n&&(n.checked=!0),q()}e.value=""}function Ne(){const t=JSON.stringify({equipmentList:d,systemTypes:y,faultTypes:g,equipmentRelations:r,sections:b,bookings:p},null,2),n=new Blob([t],{type:"application/json"}),o=document.createElement("a");o.href=URL.createObjectURL(n),o.download="equipment-utilization-data.json",o.click(),URL.revokeObjectURL(o.href)}function De(){const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=t=>{const n=t.target.files[0];if(!n)return;const o=new FileReader;o.onload=s=>{try{const i=JSON.parse(s.target.result);confirm("This will replace all current data. Are you sure?")&&(je(i),alert("Data imported successfully!"))}catch(i){alert("Error reading file: "+i.message)}},o.readAsText(n)},e.click()}function B(){let e=document.getElementById("meeting-timeline");if(!e.querySelector("#meeting-equipment-rows")){const o=document.createElement("div");o.id="meeting-equipment-rows",o.className="equipment-rows",e.appendChild(o)}L("meeting-equipment-rows",!1);const t=document.getElementById("meeting-equipment-rows"),n=e.querySelector(".no-bookings-message");if(n&&n.remove(),p.length===0){const o=document.createElement("p");o.className="no-bookings-message",o.style.textAlign="center",o.style.padding="20px",o.textContent="No bookings to display.",e.insertBefore(o,t);return}}function Re(e,t){const n=e.timeBlocks.map(a=>a.index);if(n.length===0)return;const o=Math.min(...n),s=Math.max(...n)-o+1,i=document.createElement("div");i.className="booking-summary",i.style.left=`${o*6}px`,i.style.width=`${s*6}px`,i.style.backgroundColor=Q(e.section),i.dataset.bookingId=e.id;const l=e.section.charAt(0).toUpperCase()+e.section.slice(1);i.innerHTML=`<div class="booking-summary-title">${l}</div><div>${e.comments||""}</div>`,i.title=`Time: ${e.startTime}-${X(e.endTime)}
Fault: ${e.fault}
Comments: ${e.comments||"None"}`,i.addEventListener("click",()=>ae(e.id)),t.appendChild(i)}function Oe(){const e=document.getElementById("meeting-timeline");e&&ue(e,{useCORS:!0,allowTaint:!0,scale:2}).then(t=>{const n=document.createElement("a");n.download=`meeting-overview-${new Date().toISOString().split("T")[0]}.jpg`,n.href=t.toDataURL("image/jpeg",.9),n.click()}).catch(t=>{console.error("Error exporting as JPG:",t),alert("Could not export the meeting view. Please check the console for errors.")})}function He(){if(p.length===0){alert("No bookings to export.");return}const e=[...p].sort((s,i)=>s.startTime.localeCompare(i.startTime));let t=`Morning Meeting Overview

`;e.forEach((s,i)=>{const l=d.find(a=>a.toLowerCase().replace(/\s+/g,"-")===s.equipment)||s.equipment;t+=`Booking #${i+1}: ${l} - ${s.startTime} to ${X(s.endTime)}
`,t+=`System: ${s.system}
Responsible: ${s.section}
Fault: ${s.fault}
Comments: ${s.comments||"None"}

`});const n=new Blob([t],{type:"text/plain;charset=utf-8"}),o=document.createElement("a");o.href=URL.createObjectURL(n),o.download=`meeting-overview-${new Date().toISOString().split("T")[0]}.txt`,o.click(),URL.revokeObjectURL(o.href)}function Pe(){p.length===0||!confirm("Are you sure you want to clear all bookings? This cannot be undone.")||(p=[],L("equipment-rows",!0),B(),v(),alert("All bookings have been cleared."))}function re(){if(m.length===0)return;const e=[...m].sort((n,o)=>n.time.localeCompare(o.time)),t=d.find(n=>n.toLowerCase().replace(/\s+/g,"-")===C)||C;document.getElementById("selected-equipment").textContent=t,document.getElementById("start-time").textContent=e[0].time,document.getElementById("end-time").textContent=X(e[e.length-1].time),document.getElementById("selection-info").style.display="block"}function de(){document.getElementById("selection-info").style.display="none"}function Q(e){const t=b.find(n=>n.name===e);return t?t.color:"#ddd"}function X(e){if(!e)return"";const[t,n]=e.split(":").map(Number),o=new Date(0,0,0,t,n+5);return`${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}`}function je(e){d=e.equipmentList||[],y=e.systemTypes||[],g=e.faultTypes||[],r=e.equipmentRelations||[],b=e.sections||[],p=e.bookings||[],L("equipment-rows",!0),A(),te(),w(),$(),f(),S(),B(),v()}
