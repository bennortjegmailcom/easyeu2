(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();let p=[],r=[],d=[],g=["Conveyor","Pump","Pipe","Motor","Valve","Sensor"],v=["Trip","Power Failure","Run Skew","Conveyor Torn","Rollers Damaged","Leakage","Blockage","Wear","Failure","Scheduled Maintenance"],q=[{name:"mechanical",color:"#FF9AA2"},{name:"electrical",color:"#FFB7B2"},{name:"operations",color:"#FFDAC1"},{name:"technicians",color:"#E2F0CB"},{name:"instrumentation",color:"#B5EAD7"},{name:"management",color:"#C7CEEA"}],m=[],k="",I=null;document.addEventListener("DOMContentLoaded",function(){re(),de(),L("equipment-rows",!0),Z(),x(),_(),S(),A(),N(),f(),B(),ee("tracker")});function re(){document.addEventListener("mouseup",he),document.querySelector(".tabs").addEventListener("click",e=>{e.target.classList.contains("tab")&&ee(e.target.dataset.tab)}),document.querySelector(".admin-tabs").addEventListener("click",e=>{e.target.classList.contains("admin-tab")&&D(e.target.dataset.adminTab)}),document.getElementById("equipment-select").addEventListener("change",e=>z(e.target.value)),document.getElementById("cancel-booking-btn").addEventListener("click",ie),document.getElementById("save-booking-btn").addEventListener("click",Le),document.querySelector(".system-icons").addEventListener("click",e=>{e.target.classList.contains("system-icon")&&qe(e.target,e.target.dataset.system)}),document.getElementById("export-txt-btn").addEventListener("click",Me),document.getElementById("clear-all-btn").addEventListener("click",Ne),document.getElementById("search-relations").addEventListener("input",f),document.getElementById("filter-equipment").addEventListener("change",f),document.getElementById("filter-section").addEventListener("change",f),document.getElementById("export-relations-btn").addEventListener("click",Ae),document.getElementById("import-relations-btn").addEventListener("click",$e),document.getElementById("add-new-relation-btn").addEventListener("click",Ce),document.getElementById("relations-grid-body").addEventListener("click",e=>{var o;const t=e.target.closest("button");if(!t)return;const n=(o=t.closest(".relation-grid-row"))==null?void 0:o.dataset.relationId;t.classList.contains("btn-edit-grid")&&Ie(n),t.classList.contains("btn-delete-grid")&&ke(n)}),document.getElementById("add-equipment-btn").addEventListener("click",pe),document.getElementById("add-system-btn").addEventListener("click",ne),document.getElementById("add-fault-btn").addEventListener("click",oe),document.getElementById("admin-equipment-list").addEventListener("click",e=>R(e,"equipment","deleteEquipmentItem")),document.getElementById("admin-systems-list").addEventListener("click",e=>R(e,"system","deleteSystemType")),document.getElementById("admin-faults-list").addEventListener("click",e=>R(e,"fault","deleteFaultType")),document.getElementById("builder-equipment").addEventListener("change",b),document.getElementById("builder-section").addEventListener("change",b),document.querySelector(".systems-grid").addEventListener("change",b),document.querySelector(".faults-grid").addEventListener("change",b),document.getElementById("add-custom-system-btn").addEventListener("click",Te),document.getElementById("add-custom-fault-btn").addEventListener("click",xe),document.getElementById("clear-builder-btn").addEventListener("click",J),document.getElementById("save-relation-btn").addEventListener("click",Be)}function R(e,t,n){const o=e.target.closest("button");if(!o)return;const s=e.target.closest(".admin-list-item"),i=Array.from(s.parentNode.children).indexOf(s);o.dataset.action==="edit"?me(t,i):o.dataset.action==="delete"?{deleteEquipmentItem:fe,deleteSystemType:ye,deleteFaultType:ge}[n](i):o.dataset.action==="save"?te(t,i):o.dataset.action==="cancel"&&V()}function E(){const e={bookings:p,equipmentRelations:r,equipmentList:d,systemTypes:g,faultTypes:v,sections:q};localStorage.setItem("equipmentUtilizationData",JSON.stringify(e)),console.log("Data saved.")}function de(){const e=localStorage.getItem("equipmentUtilizationData");if(e)try{const t=JSON.parse(e);p=t.bookings||[],r=t.equipmentRelations||[],d=t.equipmentList||[],g=t.systemTypes||["Conveyor","Pump","Pipe","Motor","Valve","Sensor"],v=t.faultTypes||["Trip","Power Failure","Run Skew","Conveyor Torn","Rollers Damaged","Leakage","Blockage","Wear","Failure","Scheduled Maintenance"],q=t.sections||[{name:"mechanical",color:"#FF9AA2"},{name:"electrical",color:"#FFB7B2"},{name:"operations",color:"#FFDAC1"},{name:"technicians",color:"#E2F0CB"},{name:"instrumentation",color:"#B5EAD7"},{name:"management",color:"#C7CEEA"}]}catch(t){console.error("Error parsing data from localStorage",t)}}function L(e,t){const n=document.getElementById(e);n.innerHTML="",d.forEach(o=>{const s=ue(o,t);n.appendChild(s)}),Y(e)}function Y(e){const t=document.getElementById(e);t&&(t.querySelectorAll(".time-block.booked").forEach(n=>{n.classList.remove("booked"),n.style.backgroundColor="",delete n.dataset.bookingId}),t.querySelectorAll(".booking-summary").forEach(n=>n.remove()),p.forEach(n=>{const o=t.querySelector(`[data-equipment="${n.equipment}"]`);if(!o)return;const s=n.shift==="day"?o.nextElementSibling:o.nextElementSibling.nextElementSibling,i=s==null?void 0:s.querySelector(".time-blocks");i&&(e==="equipment-rows"&&n.timeBlocks.forEach(l=>{const a=i.querySelector(`[data-index='${l.index}']`);a&&(a.classList.add("booked"),a.dataset.bookingId=n.id,a.style.backgroundColor=W(n.section))}),e==="meeting-equipment-rows"&&Fe(n,i))}))}function Z(){Y("equipment-rows")}function ue(e,t){const n=document.createElement("div");n.className="equipment-row";const o=document.createElement("div");o.className="equipment-label",o.textContent=e,o.dataset.equipment=e.toLowerCase().replace(/\s+/g,"-"),n.appendChild(o);const s=X("Day Shift (6:00-18:00)",6,18,e,t);n.appendChild(s);const i=X("Night Shift (18:00-6:00)",18,30,e,t);return n.appendChild(i),n}function X(e,t,n,o,s){const i=document.createElement("div");i.className="shift-section";const l=document.createElement("div");l.className="shift-header",l.textContent=e,i.appendChild(l);const a=document.createElement("div");a.className="time-header";const c=document.createElement("div");c.className="time-blocks";let u=0;for(let y=t;y<t+12;y++){const Q=y>=24?y-24:y;for(let T=0;T<60;T+=5){const $=document.createElement("div");$.className="time-slot",T===0&&($.textContent=`${Q.toString().padStart(2,"0")}:00`,$.classList.add("hour-mark")),a.appendChild($);const h=document.createElement("div");h.className="time-block",T===0&&h.classList.add("hour-start"),h.dataset.index=u,h.dataset.time=`${Q.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}`,h.dataset.equipment=o.toLowerCase().replace(/\s+/g,"-"),s?(h.addEventListener("mousedown",ve),h.addEventListener("mouseenter",Ee)):h.style.cursor="default",c.appendChild(h),u++}}return i.appendChild(a),i.appendChild(c),i}function O(e){var s;const t=document.getElementById(e);if(!t)return;const n=t.value,o=(s=t.querySelector('option[value=""]'))==null?void 0:s.textContent.toLowerCase().includes("all");t.innerHTML=o?'<option value="">All Equipment</option>':'<option value="">Select Equipment</option>',d.forEach(i=>{const l=i.toLowerCase().replace(/\s+/g,"-"),a=document.createElement("option");a.value=l,a.textContent=i,t.appendChild(a)}),Array.from(t.options).some(i=>i.value===n)&&(t.value=n)}function _(){document.querySelectorAll("#filter-section, #builder-section, #section-select").forEach(t=>{const n=t.value,o=t.id==="filter-section";t.innerHTML=o?'<option value="">All Sections</option>':'<option value="">Select Section</option>',q.forEach(s=>{const i=document.createElement("option");i.value=s.name,i.textContent=s.name.charAt(0).toUpperCase()+s.name.slice(1),t.appendChild(i)}),Array.from(t.options).some(s=>s.value===n)&&(t.value=n)})}function x(){O("equipment-select"),O("builder-equipment"),O("filter-equipment")}function S(){const e=(t,n,o)=>{t.innerHTML="",n.forEach(s=>{const i=`${o}-${s.toLowerCase().replace(/\s+/g,"-")}`,l=document.createElement("div");l.className=`${o}-item`,l.innerHTML=`<input type="checkbox" id="${i}" value="${s}"><label for="${i}">${s}</label>`,t.appendChild(l)})};e(document.querySelector(".systems-grid"),g,"sys"),e(document.querySelector(".faults-grid"),v,"fault")}function A(){U(),j(),G()}function P(e,t,n,o){const s=document.getElementById(e);if(s.innerHTML="",t.length===0){s.innerHTML='<p style="padding: 10px; color: #7f8c8d;">No items yet.</p>';return}t.forEach((i,l)=>{const a=document.createElement("div");if(a.className="admin-list-item",I&&I.type===n&&I.index===l){a.innerHTML=`
                        <input type="text" id="edit-input-${n}" value="${i}" class="admin-item-input">
                        <div class="admin-item-actions">
                            <button class="btn-grid btn-primary" data-action="save">Save</button>
                            <button class="btn-grid btn-secondary" data-action="cancel">Cancel</button>
                        </div>
                    `;const c=a.querySelector("input");setTimeout(()=>c==null?void 0:c.focus(),0),c.addEventListener("keydown",u=>{u.key==="Enter"&&te(n,l),u.key==="Escape"&&V()})}else a.innerHTML=`
                        <span class="admin-item-name">${i}</span>
                        <div class="admin-item-actions">
                            <button class="btn-grid btn-edit-grid" data-action="edit">Edit</button>
                            <button class="btn-grid btn-delete-grid" data-action="delete">Delete</button>
                        </div>
                    `;s.appendChild(a)})}function U(){P("admin-equipment-list",d,"equipment")}function j(){P("admin-systems-list",g,"system")}function G(){P("admin-faults-list",v,"fault")}function f(){const e=document.getElementById("relations-grid-body"),t=document.getElementById("search-relations").value.toLowerCase(),n=document.getElementById("filter-equipment").value,o=document.getElementById("filter-section").value,s=r.filter(i=>{const l=`${i.equipment} ${i.systems.join(" ")} ${i.section} ${i.faults.join(" ")}`.toLowerCase(),a=!t||l.includes(t),c=!n||i.equipment===n,u=!o||i.section===o;return a&&c&&u});if(s.length===0){e.innerHTML='<div class="no-relations">No relations found matching your criteria.</div>';return}e.innerHTML="",s.forEach(i=>{const l=d.find(c=>c.toLowerCase().replace(/\s+/g,"-")===i.equipment)||i.equipment,a=document.createElement("div");a.className="relation-grid-row",a.dataset.relationId=i.id,a.innerHTML=`
                    <div class="grid-cell"><div class="equipment-badge">${l}</div></div>
                    <div class="grid-cell"><div class="systems-list">${i.systems.map(c=>`<span class="system-tag">${c}</span>`).join("")}</div></div>
                    <div class="grid-cell"><div class="section-badge" style="background-color: ${W(i.section)}">${i.section.charAt(0).toUpperCase()+i.section.slice(1)}</div></div>
                    <div class="grid-cell"><div class="faults-list">${i.faults.map(c=>`<span class="fault-tag">${c}</span>`).join("")}</div></div>
                    <div class="grid-cell"><div class="relation-actions-grid">
                        <button class="btn-grid btn-edit-grid">Edit</button>
                        <button class="btn-grid btn-delete-grid">Delete</button>
                    </div></div>
                `,e.appendChild(a)})}function B(){document.getElementById("total-relations").textContent=r.length,document.getElementById("total-equipment").textContent=d.length,document.getElementById("total-sections").textContent=q.length}function b(){const e=document.getElementById("builder-equipment").value,t=document.getElementById("builder-section").value,n=Array.from(document.querySelectorAll(".systems-grid input:checked")).map(l=>l.value),o=Array.from(document.querySelectorAll(".faults-grid input:checked")).map(l=>l.value),s=document.getElementById("builder-preview-content");if(!e&&!t&&n.length===0&&o.length===0){s.innerHTML="<p>Select equipment and configuration to see preview</p>";return}const i=d.find(l=>l.toLowerCase().replace(/\s+/g,"-")===e)||"Not selected";s.innerHTML=`
                <div class="preview-item"><span class="preview-label">Equipment:</span> <span class="preview-value">${i}</span></div>
                <div class="preview-item"><span class="preview-label">Section:</span> <span class="preview-value">${t||"Not selected"}</span></div>
                <div class="preview-item"><span class="preview-label">Systems:</span> <span class="preview-value">${n.join(", ")||"None"}</span></div>
                <div class="preview-item"><span class="preview-label">Faults:</span> <span class="preview-value">${o.join(", ")||"None"}</span></div>
            `}function ee(e){var t,n;document.querySelectorAll(".view").forEach(o=>o.classList.remove("active")),document.querySelectorAll(".tab").forEach(o=>o.classList.remove("active")),(t=document.getElementById(e))==null||t.classList.add("active"),(n=document.querySelector(`.tab[data-tab='${e}']`))==null||n.classList.add("active"),e==="meeting"&&w(),e==="admin"&&(f(),B())}function D(e){var t,n;document.querySelectorAll(".admin-view").forEach(o=>o.classList.remove("active")),document.querySelectorAll(".admin-tab").forEach(o=>o.classList.remove("active")),(t=document.getElementById(`admin-${e}-view`))==null||t.classList.add("active"),(n=document.querySelector(`.admin-tab[data-admin-tab='${e}']`))==null||n.classList.add("active"),e==="manager"&&f()}function me(e,t){I={type:e,index:t},A()}function V(){I=null,A()}function te(e,t){const n=document.getElementById(`edit-input-${e}`);if(!n)return;const o=n.value.trim();let s,i;if(e==="equipment"?s=d:e==="system"?s=g:s=v,i=s[t],!o){alert(`The ${e} name cannot be empty.`);return}if(o.toLowerCase()!==i.toLowerCase()&&s.find(l=>l.toLowerCase()===o.toLowerCase())){alert(`This ${e} name already exists.`);return}if(o===i){V();return}if(e==="equipment"){const l=i.toLowerCase().replace(/\s+/g,"-"),a=o.toLowerCase().replace(/\s+/g,"-");s[t]=o,r.forEach(c=>{c.equipment===l&&(c.equipment=a)}),p.forEach(c=>{c.equipment===l&&(c.equipment=a)})}else e==="system"?(s[t]=o,r.forEach(l=>{const a=l.systems.findIndex(c=>c.toLowerCase()===i.toLowerCase());a>-1&&(l.systems[a]=o)})):(s[t]=o,r.forEach(l=>{const a=l.faults.findIndex(c=>c.toLowerCase()===i.toLowerCase());a>-1&&(l.faults[a]=o)}));s.sort(),I=null,A(),S(),f(),e==="equipment"&&(x(),L("equipment-rows",!0),w()),E()}function pe(){const e=document.getElementById("new-equipment-name"),t=e.value.trim();t&&!d.find(n=>n.toLowerCase()===t.toLowerCase())?(d.push(t),d.sort(),U(),x(),L("equipment-rows",!0),w(),B(),e.value="",E()):alert(t?"This equipment already exists.":"Please enter an equipment name.")}function fe(e){const t=d[e];if(confirm(`Are you sure you want to delete "${t}"? This will also remove any relations and bookings associated with it.`)){const n=t.toLowerCase().replace(/\s+/g,"-");d.splice(e,1),r=r.filter(o=>o.equipment!==n),p=p.filter(o=>o.equipment!==n),U(),x(),L("equipment-rows",!0),w(),f(),B(),E()}}function ne(){const e=document.getElementById("new-system-name"),t=e.value.trim();return t&&!g.find(n=>n.toLowerCase()===t.toLowerCase())?(g.push(t),g.sort(),j(),S(),e.value="",E(),t):(alert(t?"This system type already exists.":"Please enter a system type name."),null)}function ye(e){const t=g[e];confirm(`Are you sure you want to delete system type "${t}"? It will be removed from all relations.`)&&(g.splice(e,1),r.forEach(n=>{n.systems=n.systems.filter(o=>o.toLowerCase()!==t.toLowerCase())}),j(),S(),f(),E())}function oe(){const e=document.getElementById("new-fault-name"),t=e.value.trim();return t&&!v.find(n=>n.toLowerCase()===t.toLowerCase())?(v.push(t),v.sort(),G(),S(),e.value="",E(),t):(alert(t?"This fault type already exists.":"Please enter a fault type name."),null)}function ge(e){const t=v[e];confirm(`Are you sure you want to delete fault type "${t}"? It will be removed from all relations.`)&&(v.splice(e,1),r.forEach(n=>{n.faults=n.faults.filter(o=>o.toLowerCase()!==t.toLowerCase())}),G(),S(),f(),E())}let F=!1,H=-1,C="";function ve(e){if(e.button!==0)return;const t=e.target.closest(".time-block");if(t){if(t.classList.contains("booked")){se(t.dataset.bookingId);return}F=!0,H=parseInt(t.dataset.index),C=t.dataset.equipment,document.querySelectorAll(".time-block.selected").forEach(n=>n.classList.remove("selected")),m=[{element:t,index:H,equipment:C,time:t.dataset.time}],t.classList.add("selected"),ae(),e.preventDefault()}}function Ee(e){if(!F)return;const t=e.target.closest(".time-block");if(!t||t.classList.contains("booked")||t.dataset.equipment!==C)return;const n=t.closest(".shift-section"),o=Array.from(n.querySelectorAll(".time-block"));o.forEach(u=>u.classList.remove("selected")),m=[];const s=o.find(u=>parseInt(u.dataset.index)===H);if(!s)return;const i=o.indexOf(s),l=o.indexOf(t),[a,c]=[Math.min(i,l),Math.max(i,l)];for(let u=a;u<=c;u++){const y=o[u];y&&!y.classList.contains("booked")&&(y.classList.add("selected"),m.push({element:y,index:parseInt(y.dataset.index),equipment:C,time:y.dataset.time}))}ae()}function he(){F&&(F=!1,m.length>0?be():ce())}function be(){if(le(),document.getElementById("modal-overlay").style.display="block",document.getElementById("booking-modal").style.display="block",m.length>0){const e=m[0].equipment;document.getElementById("equipment-select").value=e,z(e)}}function ie(){document.getElementById("modal-overlay").style.display="none",document.getElementById("booking-modal").style.display="none",document.querySelectorAll(".time-block.selected").forEach(e=>e.classList.remove("selected")),m=[],ce()}function qe(e,t){document.querySelectorAll(".system-icon").forEach(n=>n.classList.remove("selected")),e.classList.add("selected"),k=t}function Le(){const e=document.getElementById("equipment-select").value,t=document.getElementById("section-select").value,n=document.getElementById("fault-select").value;if(!e||!t||!n||!k){alert("Please fill in all required fields");return}m.sort((i,l)=>i.time.localeCompare(l.time));const o=m[0].element.closest(".shift-section").querySelector(".shift-header").textContent.includes("Day")?"day":"night",s={id:Date.now().toString(),equipment:e,system:k,section:t,fault:n,comments:document.getElementById("comments").value,timeBlocks:m.map(i=>({index:i.index,time:i.time})),startTime:m[0].time,endTime:m[m.length-1].time,shift:o};p.push(s),ie(),Z(),document.getElementById("meeting").classList.contains("active")&&w(),E()}function se(e){const t=p.find(o=>o.id===e);if(!t)return;le(),document.getElementById("booking-modal-title").textContent="Booking Details",document.getElementById("equipment-select").value=t.equipment,z(t.equipment,t),document.getElementById("section-select").value=t.section,document.getElementById("fault-select").value=t.fault,document.getElementById("comments").value=t.comments,document.querySelectorAll("#booking-modal select, #booking-modal textarea").forEach(o=>o.disabled=!0),document.querySelectorAll(".system-icon").forEach(o=>o.style.pointerEvents="none");const n=document.getElementById("save-booking-btn");n.style.display="none",document.getElementById("cancel-booking-btn").textContent="Close",document.getElementById("modal-overlay").style.display="block",document.getElementById("booking-modal").style.display="block"}function le(){document.getElementById("booking-modal-title").textContent="Add Equipment Booking";const e=document.getElementById("booking-modal");e.querySelectorAll("select, textarea").forEach(t=>{t.disabled=!1,t.tagName!=="SELECT"&&(t.value="")}),e.querySelector("#equipment-select").value="",document.querySelectorAll(".system-icon").forEach(t=>t.style.pointerEvents="auto"),N(),document.getElementById("save-booking-btn").style.display="inline-block",document.getElementById("cancel-booking-btn").textContent="Cancel"}function z(e,t=null){if(!e){N();return}const n=r.filter(l=>l.equipment===e);if(n.length===0){N();return}const o=[...new Set(n.flatMap(l=>l.systems))],s=[...new Set(n.map(l=>l.section))],i=[...new Set(n.flatMap(l=>l.faults))];Se(o,t),M("section-select",s,"Section"),M("fault-select",i,"Fault")}function Se(e,t){const n=document.querySelector(".system-icons");if(n.innerHTML="",k="",e.length===0)return;let o=t?t.system:e[0].toLowerCase().replace(/\s+/g,"-");e.forEach(s=>{const i=s.toLowerCase().replace(/\s+/g,"-"),l=document.createElement("div");l.className="system-icon",l.dataset.system=i,l.textContent=s,i===o&&(l.classList.add("selected"),k=i),n.appendChild(l)})}function M(e,t,n){const o=document.getElementById(e);o.innerHTML=`<option value="">Select ${n}</option>`,t.forEach(s=>{const i=document.createElement("option"),l=s.toLowerCase().replace(/\s+/g,"-");i.value=l,i.textContent=s.charAt(0).toUpperCase()+s.slice(1),o.appendChild(i)})}function N(){document.querySelector(".system-icons").innerHTML='<p style="color: #7f8c8d; font-size: 12px;">Select equipment to see options.</p>',k="",M("section-select",[],"Section"),M("fault-select",[],"Fault")}function Be(){const e=document.getElementById("builder-equipment").value,t=document.getElementById("builder-section").value,n=Array.from(document.querySelectorAll(".systems-grid input:checked")).map(i=>i.value),o=Array.from(document.querySelectorAll(".faults-grid input:checked")).map(i=>i.value);if(!e||!t||n.length===0||o.length===0){alert("Please fill all fields and select at least one system and fault.");return}const s=document.getElementById("builder-equipment").dataset.editingId;if(s){const i=r.findIndex(l=>l.id===s);i!==-1&&(r[i]={...r[i],equipment:e,section:t,systems:n,faults:o})}else r.push({id:Date.now().toString(),equipment:e,section:t,systems:n,faults:o});alert(`Relation ${s?"updated":"created"} successfully`),J(),f(),B(),D("manager"),E()}function J(){document.getElementById("builder-equipment").value="",document.getElementById("builder-section").value="",document.querySelectorAll(".systems-grid input, .faults-grid input").forEach(e=>e.checked=!1),delete document.getElementById("builder-equipment").dataset.editingId,b()}function we(e){document.getElementById("builder-equipment").value=e.equipment,document.getElementById("builder-section").value=e.section,document.querySelectorAll(".systems-grid input, .faults-grid input").forEach(t=>t.checked=!1),e.systems.forEach(t=>{const n=document.querySelector(`.systems-grid input[value="${t}"]`);n&&(n.checked=!0)}),e.faults.forEach(t=>{const n=document.querySelector(`.faults-grid input[value="${t}"]`);n&&(n.checked=!0)}),document.getElementById("builder-equipment").dataset.editingId=e.id,b()}function Ie(e){const t=r.find(n=>n.id===e);t&&(we(t),D("builder"))}function ke(e){confirm("Are you sure you want to delete this relation?")&&(r=r.filter(t=>t.id!==e),f(),B(),E())}function Ce(){J(),D("builder")}function Te(){const e=document.getElementById("custom-system"),t=ne();if(t){const n=document.querySelector(`.systems-grid input[value="${t}"]`);n&&(n.checked=!0),b()}e.value=""}function xe(){const e=document.getElementById("custom-fault"),t=oe();if(t){const n=document.querySelector(`.faults-grid input[value="${t}"]`);n&&(n.checked=!0),b()}e.value=""}function Ae(){const t=JSON.stringify({equipmentList:d,systemTypes:g,faultTypes:v,equipmentRelations:r,sections:q,bookings:p},null,2),n=new Blob([t],{type:"application/json"}),o=document.createElement("a");o.href=URL.createObjectURL(n),o.download="equipment-utilization-data.json",o.click(),URL.revokeObjectURL(o.href)}function $e(){const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=t=>{const n=t.target.files[0];if(!n)return;const o=new FileReader;o.onload=s=>{try{const i=JSON.parse(s.target.result);confirm("This will replace all current data. Are you sure?")&&(De(i),alert("Data imported successfully!"))}catch(i){alert("Error reading file: "+i.message)}},o.readAsText(n)},e.click()}function w(){let e=document.getElementById("meeting-timeline");if(!e.querySelector("#meeting-equipment-rows")){const o=document.createElement("div");o.id="meeting-equipment-rows",o.className="equipment-rows",e.appendChild(o)}L("meeting-equipment-rows",!1);const t=document.getElementById("meeting-equipment-rows"),n=e.querySelector(".no-bookings-message");if(n&&n.remove(),p.length===0){const o=document.createElement("p");o.className="no-bookings-message",o.style.textAlign="center",o.style.padding="20px",o.textContent="No bookings to display.",e.insertBefore(o,t);return}}function Fe(e,t){const n=e.timeBlocks.map(a=>a.index);if(n.length===0)return;const o=Math.min(...n),s=Math.max(...n)-o+1,i=document.createElement("div");i.className="booking-summary",i.style.left=`${o*6}px`,i.style.width=`${s*6}px`,i.style.backgroundColor=W(e.section),i.dataset.bookingId=e.id;const l=e.section.charAt(0).toUpperCase()+e.section.slice(1);i.innerHTML=`<div class="booking-summary-title">${l}</div><div>${e.comments||""}</div>`,i.title=`Time: ${e.startTime}-${K(e.endTime)}
Fault: ${e.fault}
Comments: ${e.comments||"None"}`,i.addEventListener("click",()=>se(e.id)),t.appendChild(i)}function Me(){if(p.length===0){alert("No bookings to export.");return}const e=[...p].sort((s,i)=>s.startTime.localeCompare(i.startTime));let t=`Morning Meeting Overview

`;e.forEach((s,i)=>{const l=d.find(a=>a.toLowerCase().replace(/\s+/g,"-")===s.equipment)||s.equipment;t+=`Booking #${i+1}: ${l} - ${s.startTime} to ${K(s.endTime)}
`,t+=`System: ${s.system}
Responsible: ${s.section}
Fault: ${s.fault}
Comments: ${s.comments||"None"}

`});const n=new Blob([t],{type:"text/plain;charset=utf-8"}),o=document.createElement("a");o.href=URL.createObjectURL(n),o.download=`meeting-overview-${new Date().toISOString().split("T")[0]}.txt`,o.click(),URL.revokeObjectURL(o.href)}function Ne(){p.length===0||!confirm("Are you sure you want to clear all bookings? This cannot be undone.")||(p=[],L("equipment-rows",!0),w(),E(),alert("All bookings have been cleared."))}function ae(){if(m.length===0)return;const e=[...m].sort((n,o)=>n.time.localeCompare(o.time)),t=d.find(n=>n.toLowerCase().replace(/\s+/g,"-")===C)||C;document.getElementById("selected-equipment").textContent=t,document.getElementById("start-time").textContent=e[0].time,document.getElementById("end-time").textContent=K(e[e.length-1].time),document.getElementById("selection-info").style.display="block"}function ce(){document.getElementById("selection-info").style.display="none"}function W(e){const t=q.find(n=>n.name===e);return t?t.color:"#ddd"}function K(e){if(!e)return"";const[t,n]=e.split(":").map(Number),o=new Date(0,0,0,t,n+5);return`${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}`}function De(e){d=e.equipmentList||[],g=e.systemTypes||[],v=e.faultTypes||[],r=e.equipmentRelations||[],q=e.sections||[],p=e.bookings||[],L("equipment-rows",!0),x(),_(),S(),A(),f(),B(),w(),E()}
