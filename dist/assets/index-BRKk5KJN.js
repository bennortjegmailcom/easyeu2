import ue from"html2canvas";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();let y=[],d=[],m=[],v=["Conveyor","Pump","Pipe","Motor","Valve","Sensor"],E=["Trip","Power Failure","Run Skew","Conveyor Torn","Rollers Damaged","Leakage","Blockage","Wear","Failure","Scheduled Maintenance"],r=[{name:"mechanical",color:"#FF9AA2"},{name:"electrical",color:"#FFB7B2"},{name:"operations",color:"#FFDAC1"},{name:"technicians",color:"#E2F0CB"},{name:"instrumentation",color:"#B5EAD7"},{name:"management",color:"#C7CEEA"}],p=[],C="",L=null,N="24h";document.addEventListener("DOMContentLoaded",function(){pe(),fe(),S("equipment-rows",!0),G(),$(),A(),I(),M(),P(),f(),q(),oe("tracker")});function pe(){document.addEventListener("mouseup",Be),document.getElementById("timeline-view-select").addEventListener("change",ge),document.querySelector(".tabs").addEventListener("click",e=>{e.target.classList.contains("tab")&&oe(e.target.dataset.tab)}),document.querySelector(".admin-tabs").addEventListener("click",e=>{e.target.classList.contains("admin-tab")&&j(e.target.dataset.adminTab)}),document.getElementById("equipment-select").addEventListener("change",e=>X(e.target.value)),document.getElementById("cancel-booking-btn").addEventListener("click",le),document.getElementById("save-booking-btn").addEventListener("click",Te),document.querySelector(".system-icons").addEventListener("click",e=>{e.target.classList.contains("system-icon")&&ke(e.target,e.target.dataset.system)}),document.getElementById("export-jpg-btn").addEventListener("click",je),document.getElementById("export-txt-btn").addEventListener("click",Ue),document.getElementById("clear-all-btn").addEventListener("click",Ve),document.getElementById("search-relations").addEventListener("input",f),document.getElementById("filter-equipment").addEventListener("change",f),document.getElementById("filter-section").addEventListener("change",f),document.getElementById("export-relations-btn").addEventListener("click",Oe),document.getElementById("import-relations-btn").addEventListener("click",He),document.getElementById("add-new-relation-btn").addEventListener("click",Ne),document.getElementById("relations-grid-body").addEventListener("click",e=>{var o;const t=e.target.closest("button");if(!t)return;const n=(o=t.closest(".relation-grid-row"))==null?void 0:o.dataset.relationId;t.classList.contains("btn-edit-grid")&&Me(n),t.classList.contains("btn-delete-grid")&&Fe(n)}),document.getElementById("add-equipment-btn").addEventListener("click",Ee),document.getElementById("add-system-btn").addEventListener("click",se),document.getElementById("add-fault-btn").addEventListener("click",ae),document.getElementById("add-section-btn").addEventListener("click",be),document.getElementById("admin-equipment-list").addEventListener("click",e=>D(e,"equipment","deleteEquipmentItem")),document.getElementById("admin-systems-list").addEventListener("click",e=>D(e,"system","deleteSystemType")),document.getElementById("admin-faults-list").addEventListener("click",e=>D(e,"fault","deleteFaultType")),document.getElementById("admin-sections-list").addEventListener("click",e=>D(e,"section","deleteSectionItem")),document.getElementById("builder-equipment").addEventListener("change",w),document.getElementById("builder-section").addEventListener("change",w),document.querySelector(".systems-grid").addEventListener("change",w),document.querySelector(".faults-grid").addEventListener("change",w),document.getElementById("add-custom-system-btn").addEventListener("click",De),document.getElementById("add-custom-fault-btn").addEventListener("click",Re),document.getElementById("clear-builder-btn").addEventListener("click",Y),document.getElementById("save-relation-btn").addEventListener("click",Ae)}function D(e,t,n){const o=e.target.closest("button");if(!o)return;const s=e.target.closest(".admin-list-item"),i=Array.from(s.parentNode.children).indexOf(s);o.dataset.action==="edit"?ve(t,i):o.dataset.action==="delete"?{deleteEquipmentItem:he,deleteSystemType:qe,deleteFaultType:we,deleteSectionItem:Le}[n](i):o.dataset.action==="save"?ie(t,i):o.dataset.action==="cancel"&&R()}function g(){const e={bookings:y,equipmentRelations:d,equipmentList:m,systemTypes:v,faultTypes:E,sections:r};localStorage.setItem("equipmentUtilizationData",JSON.stringify(e)),console.log("Data saved.")}function fe(){const e=localStorage.getItem("equipmentUtilizationData");if(e)try{const t=JSON.parse(e);y=t.bookings||[],d=t.equipmentRelations||[],m=t.equipmentList||[],v=t.systemTypes||["Conveyor","Pump","Pipe","Motor","Valve","Sensor"],E=t.faultTypes||["Trip","Power Failure","Run Skew","Conveyor Torn","Rollers Damaged","Leakage","Blockage","Wear","Failure","Scheduled Maintenance"],r=t.sections||[{name:"mechanical",color:"#FF9AA2"},{name:"electrical",color:"#FFB7B2"},{name:"operations",color:"#FFDAC1"},{name:"technicians",color:"#E2F0CB"},{name:"instrumentation",color:"#B5EAD7"},{name:"management",color:"#C7CEEA"}]}catch(t){console.error("Error parsing data from localStorage",t)}}function S(e,t){const n=document.getElementById(e);n.innerHTML="",m.forEach(o=>{const s=ye(o,t);n.appendChild(s)}),ne(e)}function ne(e){const t=document.getElementById(e);t&&(t.querySelectorAll(".time-block.booked").forEach(n=>{n.classList.remove("booked"),n.style.backgroundColor="",delete n.dataset.bookingId}),t.querySelectorAll(".booking-summary").forEach(n=>n.remove()),y.forEach(n=>{const o=t.querySelector(`[data-equipment="${n.equipment}"]`);if(!o)return;const s=n.shift==="day"?o.nextElementSibling:o.nextElementSibling.nextElementSibling,i=s==null?void 0:s.querySelector(".time-blocks");i&&(e==="equipment-rows"&&n.timeBlocks.forEach(a=>{const l=i.querySelector(`[data-index='${a.index}']`);l&&(l.classList.add("booked"),l.dataset.bookingId=n.id,l.style.backgroundColor=Z(n.section))}),e==="meeting-equipment-rows"&&Pe(n,i))}))}function G(){ne("equipment-rows")}function ye(e,t){const n=document.createElement("div");n.className="equipment-row";const o=document.createElement("div");o.className="equipment-label",o.textContent=e,o.dataset.equipment=e.toLowerCase().replace(/\s+/g,"-"),n.appendChild(o);const s=te("Day Shift (6:00-18:00)",6,18,e,t,"day");n.appendChild(s);const i=te("Night Shift (18:00-6:00)",18,30,e,t,"night");return n.appendChild(i),n}function te(e,t,n,o,s,i){const a=document.createElement("div");a.className="shift-section",a.dataset.shift=i;const l=document.createElement("div");l.className="shift-header",l.textContent=e,a.appendChild(l);const c=document.createElement("div");c.className="time-header";const u=document.createElement("div");u.className="time-blocks";let h=0;for(let T=t;T<t+12;T++){const ee=T>=24?T-24:T;for(let x=0;x<60;x+=5){const F=document.createElement("div");F.className="time-slot",x===0&&(F.textContent=`${ee.toString().padStart(2,"0")}:00`,F.classList.add("hour-mark")),c.appendChild(F);const b=document.createElement("div");b.className="time-block",x===0&&b.classList.add("hour-start"),b.dataset.index=h,b.dataset.time=`${ee.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`,b.dataset.equipment=o.toLowerCase().replace(/\s+/g,"-"),s?(b.addEventListener("mousedown",Se),b.addEventListener("mouseenter",Ie)):b.style.cursor="default",u.appendChild(b),h++}}return a.appendChild(c),a.appendChild(u),a}function U(e){var s;const t=document.getElementById(e);if(!t)return;const n=t.value,o=(s=t.querySelector('option[value=""]'))==null?void 0:s.textContent.toLowerCase().includes("all");t.innerHTML=o?'<option value="">All Equipment</option>':'<option value="">Select Equipment</option>',m.forEach(i=>{const a=i.toLowerCase().replace(/\s+/g,"-"),l=document.createElement("option");l.value=a,l.textContent=i,t.appendChild(l)}),Array.from(t.options).some(i=>i.value===n)&&(t.value=n)}function A(){document.querySelectorAll("#filter-section, #builder-section, #section-select").forEach(t=>{const n=t.value,o=t.id==="filter-section";t.innerHTML=o?'<option value="">All Sections</option>':'<option value="">Select Section</option>',r.forEach(s=>{const i=document.createElement("option");i.value=s.name,i.textContent=s.name.charAt(0).toUpperCase()+s.name.slice(1),t.appendChild(i)}),Array.from(t.options).some(s=>s.value===n)&&(t.value=n)})}function $(){U("equipment-select"),U("builder-equipment"),U("filter-equipment")}function I(){const e=(t,n,o)=>{t.innerHTML="",n.forEach(s=>{const i=`${o}-${s.toLowerCase().replace(/\s+/g,"-")}`,a=document.createElement("div");a.className=`${o}-item`,a.innerHTML=`<input type="checkbox" id="${i}" value="${s}"><label for="${i}">${s}</label>`,t.appendChild(a)})};e(document.querySelector(".systems-grid"),v,"sys"),e(document.querySelector(".faults-grid"),E,"fault")}function M(){z(),W(),K(),Q()}function J(e,t,n,o){const s=document.getElementById(e);if(s.innerHTML="",t.length===0){s.innerHTML='<p style="padding: 10px; color: #7f8c8d;">No items yet.</p>';return}t.forEach((i,a)=>{const l=document.createElement("div");if(l.className="admin-list-item",L&&L.type===n&&L.index===a){l.innerHTML=`
                        <input type="text" id="edit-input-${n}" value="${i}" class="admin-item-input">
                        <div class="admin-item-actions">
                            <button class="btn-grid btn-primary" data-action="save">Save</button>
                            <button class="btn-grid btn-secondary" data-action="cancel">Cancel</button>
                        </div>
                    `;const c=l.querySelector("input");setTimeout(()=>c==null?void 0:c.focus(),0),c.addEventListener("keydown",u=>{u.key==="Enter"&&ie(n,a),u.key==="Escape"&&R()})}else l.innerHTML=`
                        <span class="admin-item-name">${i}</span>
                        <div class="admin-item-actions">
                            <button class="btn-grid btn-edit-grid" data-action="edit">Edit</button>
                            <button class="btn-grid btn-delete-grid" data-action="delete">Delete</button>
                        </div>
                    `;s.appendChild(l)})}function z(){J("admin-equipment-list",m,"equipment")}function W(){J("admin-systems-list",v,"system")}function K(){J("admin-faults-list",E,"fault")}function Q(){const e=document.getElementById("admin-sections-list");if(e.innerHTML="",r.length===0){e.innerHTML='<p style="padding: 10px; color: #7f8c8d;">No sections yet.</p>';return}r.forEach((t,n)=>{const o=document.createElement("div");o.className="admin-list-item",L&&L.type==="section"&&L.index===n?o.innerHTML=`
                        <input type="text" id="edit-input-section-name" value="${t.name}" class="admin-item-input" style="flex-grow: 0.5;">
                        <input type="color" id="edit-input-section-color" value="${t.color}" class="admin-item-input" style="flex-grow: 0.5;">
                        <div class="admin-item-actions">
                            <button class="btn-grid btn-primary" data-action="save">Save</button>
                            <button class="btn-grid btn-secondary" data-action="cancel">Cancel</button>
                        </div>
                    `:o.innerHTML=`
                        <span class="admin-item-name">
                            <span class="color-indicator" style="background-color: ${t.color};"></span>
                            ${t.name}
                        </span>
                        <div class="admin-item-actions">
                            <button class="btn-grid btn-edit-grid" data-action="edit">Edit</button>
                            <button class="btn-grid btn-delete-grid" data-action="delete">Delete</button>
                        </div>
                    `,e.appendChild(o)})}function f(){const e=document.getElementById("relations-grid-body"),t=document.getElementById("search-relations").value.toLowerCase(),n=document.getElementById("filter-equipment").value,o=document.getElementById("filter-section").value,s=d.filter(i=>{const a=`${i.equipment} ${i.systems.join(" ")} ${i.section} ${i.faults.join(" ")}`.toLowerCase(),l=!t||a.includes(t),c=!n||i.equipment===n,u=!o||i.section===o;return l&&c&&u});if(s.length===0){e.innerHTML='<div class="no-relations">No relations found matching your criteria.</div>';return}e.innerHTML="",s.forEach(i=>{const a=m.find(c=>c.toLowerCase().replace(/\s+/g,"-")===i.equipment)||i.equipment,l=document.createElement("div");l.className="relation-grid-row",l.dataset.relationId=i.id,l.innerHTML=`
                    <div class="grid-cell"><div class="equipment-badge">${a}</div></div>
                    <div class="grid-cell"><div class="systems-list">${i.systems.map(c=>`<span class="system-tag">${c}</span>`).join("")}</div></div>
                    <div class="grid-cell"><div class="section-badge" style="background-color: ${Z(i.section)}">${i.section.charAt(0).toUpperCase()+i.section.slice(1)}</div></div>
                    <div class="grid-cell"><div class="faults-list">${i.faults.map(c=>`<span class="fault-tag">${c}</span>`).join("")}</div></div>
                    <div class="grid-cell"><div class="relation-actions-grid">
                        <button class="btn-grid btn-edit-grid">Edit</button>
                        <button class="btn-grid btn-delete-grid">Delete</button>
                    </div></div>
                `,e.appendChild(l)})}function q(){document.getElementById("total-relations").textContent=d.length,document.getElementById("total-equipment").textContent=m.length,document.getElementById("total-sections").textContent=r.length}function ge(){N=document.getElementById("timeline-view-select").value,document.querySelectorAll(".equipment-row").forEach(n=>{const o=n.querySelector('.shift-section[data-shift="day"]'),s=n.querySelector('.shift-section[data-shift="night"]');o.classList.remove("shift-hidden","shift-full-width"),s.classList.remove("shift-hidden","shift-full-width"),N==="day"?(s.classList.add("shift-hidden"),o.classList.add("shift-full-width")):N==="night"&&(o.classList.add("shift-hidden"),s.classList.add("shift-full-width"))});const t=document.getElementById("tracker").querySelector(".timeline-container");N==="24h"?t.classList.remove("single-shift-view"):t.classList.add("single-shift-view")}function w(){const e=document.getElementById("builder-equipment").value,t=document.getElementById("builder-section").value,n=Array.from(document.querySelectorAll(".systems-grid input:checked")).map(a=>a.value),o=Array.from(document.querySelectorAll(".faults-grid input:checked")).map(a=>a.value),s=document.getElementById("builder-preview-content");if(!e&&!t&&n.length===0&&o.length===0){s.innerHTML="<p>Select equipment and configuration to see preview</p>";return}const i=m.find(a=>a.toLowerCase().replace(/\s+/g,"-")===e)||"Not selected";s.innerHTML=`
                <div class="preview-item"><span class="preview-label">Equipment:</span> <span class="preview-value">${i}</span></div>
                <div class="preview-item"><span class="preview-label">Section:</span> <span class="preview-value">${t||"Not selected"}</span></div>
                <div class="preview-item"><span class="preview-label">Systems:</span> <span class="preview-value">${n.join(", ")||"None"}</span></div>
                <div class="preview-item"><span class="preview-label">Faults:</span> <span class="preview-value">${o.join(", ")||"None"}</span></div>
            `}function oe(e){var t,n;document.querySelectorAll(".view").forEach(o=>o.classList.remove("active")),document.querySelectorAll(".tab").forEach(o=>o.classList.remove("active")),(t=document.getElementById(e))==null||t.classList.add("active"),(n=document.querySelector(`.tab[data-tab='${e}']`))==null||n.classList.add("active"),e==="meeting"&&B(),e==="admin"&&(f(),q())}function j(e){var t,n;document.querySelectorAll(".admin-view").forEach(o=>o.classList.remove("active")),document.querySelectorAll(".admin-tab").forEach(o=>o.classList.remove("active")),(t=document.getElementById(`admin-${e}-view`))==null||t.classList.add("active"),(n=document.querySelector(`.admin-tab[data-admin-tab='${e}']`))==null||n.classList.add("active"),e==="manager"&&f()}function ve(e,t){L={type:e,index:t},M()}function R(){L=null,M()}function ie(e,t){if(e==="section"){const n=document.getElementById("edit-input-section-name"),o=document.getElementById("edit-input-section-color"),s=n.value.trim(),i=o.value,a=r[t];if(!s){alert("The section name cannot be empty.");return}if(s.toLowerCase()!==a.name.toLowerCase()&&r.find(l=>l.name.toLowerCase()===s.toLowerCase())){alert("This section name already exists.");return}if(s===a.name&&i===a.color){R();return}d.forEach(l=>{l.section===a.name&&(l.section=s)}),r[t]={name:s,color:i},r.sort((l,c)=>l.name.localeCompare(c.name)),A(),f(),G()}else{const n=document.getElementById(`edit-input-${e}`);if(!n)return;const o=n.value.trim();let s,i;if(e==="equipment"?s=m:e==="system"?s=v:s=E,i=s[t],!o){alert(`The ${e} name cannot be empty.`);return}if(o.toLowerCase()!==i.toLowerCase()&&s.find(a=>a.toLowerCase()===o.toLowerCase())){alert(`This ${e} name already exists.`);return}if(o===i){R();return}if(e==="equipment"){const a=i.toLowerCase().replace(/\s+/g,"-"),l=o.toLowerCase().replace(/\s+/g,"-");s[t]=o,d.forEach(c=>{c.equipment===a&&(c.equipment=l)}),y.forEach(c=>{c.equipment===a&&(c.equipment=l)})}else e==="system"?(s[t]=o,d.forEach(a=>{const l=a.systems.findIndex(c=>c.toLowerCase()===i.toLowerCase());l>-1&&(a.systems[l]=o)})):(s[t]=o,d.forEach(a=>{const l=a.faults.findIndex(c=>c.toLowerCase()===i.toLowerCase());l>-1&&(a.faults[l]=o)}));s.sort(),I(),f(),e==="equipment"&&($(),S("equipment-rows",!0),B())}L=null,M(),g()}function Ee(){const e=document.getElementById("new-equipment-name"),t=e.value.trim();t&&!m.find(n=>n.toLowerCase()===t.toLowerCase())?(m.push(t),m.sort(),z(),$(),S("equipment-rows",!0),B(),q(),e.value="",g()):alert(t?"This equipment already exists.":"Please enter an equipment name.")}function he(e){const t=m[e];if(confirm(`Are you sure you want to delete "${t}"? This will also remove any relations and bookings associated with it.`)){const n=t.toLowerCase().replace(/\s+/g,"-");m.splice(e,1),d=d.filter(o=>o.equipment!==n),y=y.filter(o=>o.equipment!==n),z(),$(),S("equipment-rows",!0),B(),f(),q(),g()}}function be(){const e=document.getElementById("new-section-name"),t=document.getElementById("new-section-color"),n=e.value.trim(),o=t.value;n&&!r.find(s=>s.name.toLowerCase()===n.toLowerCase())?(r.push({name:n,color:o}),r.sort((s,i)=>s.name.localeCompare(i.name)),Q(),A(),q(),e.value="",g()):alert(n?"This section name already exists.":"Please enter a section name.")}function Le(e){const t=r[e];confirm(`Are you sure you want to delete section "${t.name}"? It will be removed from all relations.`)&&(r.splice(e,1),d=d.filter(n=>n.section!==t.name),Q(),A(),f(),q(),g())}function se(){const e=document.getElementById("new-system-name"),t=e.value.trim();return t&&!v.find(n=>n.toLowerCase()===t.toLowerCase())?(v.push(t),v.sort(),W(),I(),e.value="",g(),t):(alert(t?"This system type already exists.":"Please enter a system type name."),null)}function qe(e){const t=v[e];confirm(`Are you sure you want to delete system type "${t}"? It will be removed from all relations.`)&&(v.splice(e,1),d.forEach(n=>{n.systems=n.systems.filter(o=>o.toLowerCase()!==t.toLowerCase())}),W(),I(),f(),g())}function ae(){const e=document.getElementById("new-fault-name"),t=e.value.trim();return t&&!E.find(n=>n.toLowerCase()===t.toLowerCase())?(E.push(t),E.sort(),K(),I(),e.value="",g(),t):(alert(t?"This fault type already exists.":"Please enter a fault type name."),null)}function we(e){const t=E[e];confirm(`Are you sure you want to delete fault type "${t}"? It will be removed from all relations.`)&&(E.splice(e,1),d.forEach(n=>{n.faults=n.faults.filter(o=>o.toLowerCase()!==t.toLowerCase())}),K(),I(),f(),g())}let O=!1,V=-1,k="";function Se(e){if(e.button!==0)return;const t=e.target.closest(".time-block");if(t){if(t.classList.contains("booked")){ce(t.dataset.bookingId);return}O=!0,V=parseInt(t.dataset.index),k=t.dataset.equipment,document.querySelectorAll(".time-block.selected").forEach(n=>n.classList.remove("selected")),p=[{element:t,index:V,equipment:k,time:t.dataset.time}],t.classList.add("selected"),re(),e.preventDefault()}}function Ie(e){if(!O)return;const t=e.target.closest(".time-block");if(!t||t.classList.contains("booked")||t.dataset.equipment!==k)return;const n=t.closest(".shift-section"),o=Array.from(n.querySelectorAll(".time-block"));o.forEach(u=>u.classList.remove("selected")),p=[];const s=o.find(u=>parseInt(u.dataset.index)===V);if(!s)return;const i=o.indexOf(s),a=o.indexOf(t),[l,c]=[Math.min(i,a),Math.max(i,a)];for(let u=l;u<=c;u++){const h=o[u];h&&!h.classList.contains("booked")&&(h.classList.add("selected"),p.push({element:h,index:parseInt(h.dataset.index),equipment:k,time:h.dataset.time}))}re()}function Be(){O&&(O=!1,p.length>0?Ce():me())}function Ce(){if(de(),document.getElementById("modal-overlay").style.display="block",document.getElementById("booking-modal").style.display="block",p.length>0){const e=p[0].equipment;document.getElementById("equipment-select").value=e,X(e)}}function le(){document.getElementById("modal-overlay").style.display="none",document.getElementById("booking-modal").style.display="none",document.querySelectorAll(".time-block.selected").forEach(e=>e.classList.remove("selected")),p=[],me()}function ke(e,t){document.querySelectorAll(".system-icon").forEach(n=>n.classList.remove("selected")),e.classList.add("selected"),C=t}function Te(){const e=document.getElementById("equipment-select").value,t=document.getElementById("section-select").value,n=document.getElementById("fault-select").value;if(!e||!t||!n||!C){alert("Please fill in all required fields");return}p.sort((i,a)=>i.time.localeCompare(a.time));const o=p[0].element.closest(".shift-section").querySelector(".shift-header").textContent.includes("Day")?"day":"night",s={id:Date.now().toString(),equipment:e,system:C,section:t,fault:n,comments:document.getElementById("comments").value,timeBlocks:p.map(i=>({index:i.index,time:i.time})),startTime:p[0].time,endTime:p[p.length-1].time,shift:o};y.push(s),le(),G(),document.getElementById("meeting").classList.contains("active")&&B(),g()}function ce(e){const t=y.find(o=>o.id===e);if(!t)return;de(),document.getElementById("booking-modal-title").textContent="Booking Details",document.getElementById("equipment-select").value=t.equipment,X(t.equipment,t),document.getElementById("section-select").value=t.section,document.getElementById("fault-select").value=t.fault,document.getElementById("comments").value=t.comments,document.querySelectorAll("#booking-modal select, #booking-modal textarea").forEach(o=>o.disabled=!0),document.querySelectorAll(".system-icon").forEach(o=>o.style.pointerEvents="none");const n=document.getElementById("save-booking-btn");n.style.display="none",document.getElementById("cancel-booking-btn").textContent="Close",document.getElementById("modal-overlay").style.display="block",document.getElementById("booking-modal").style.display="block"}function de(){document.getElementById("booking-modal-title").textContent="Add Equipment Booking";const e=document.getElementById("booking-modal");e.querySelectorAll("select, textarea").forEach(t=>{t.disabled=!1,t.tagName!=="SELECT"&&(t.value="")}),e.querySelector("#equipment-select").value="",document.querySelectorAll(".system-icon").forEach(t=>t.style.pointerEvents="auto"),P(),document.getElementById("save-booking-btn").style.display="inline-block",document.getElementById("cancel-booking-btn").textContent="Cancel"}function X(e,t=null){if(!e){P();return}const n=d.filter(a=>a.equipment===e);if(n.length===0){P();return}const o=[...new Set(n.flatMap(a=>a.systems))],s=[...new Set(n.map(a=>a.section))],i=[...new Set(n.flatMap(a=>a.faults))];xe(o,t),H("section-select",s,"Section"),H("fault-select",i,"Fault")}function xe(e,t){const n=document.querySelector(".system-icons");if(n.innerHTML="",C="",e.length===0)return;let o=t?t.system:e[0].toLowerCase().replace(/\s+/g,"-");e.forEach(s=>{const i=s.toLowerCase().replace(/\s+/g,"-"),a=document.createElement("div");a.className="system-icon",a.dataset.system=i,a.textContent=s,i===o&&(a.classList.add("selected"),C=i),n.appendChild(a)})}function H(e,t,n){const o=document.getElementById(e);o.innerHTML=`<option value="">Select ${n}</option>`,t.forEach(s=>{const i=document.createElement("option"),a=s.toLowerCase().replace(/\s+/g,"-");i.value=a,i.textContent=s.charAt(0).toUpperCase()+s.slice(1),o.appendChild(i)})}function P(){document.querySelector(".system-icons").innerHTML='<p style="color: #7f8c8d; font-size: 12px;">Select equipment to see options.</p>',C="",H("section-select",[],"Section"),H("fault-select",[],"Fault")}function Ae(){const e=document.getElementById("builder-equipment").value,t=document.getElementById("builder-section").value,n=Array.from(document.querySelectorAll(".systems-grid input:checked")).map(i=>i.value),o=Array.from(document.querySelectorAll(".faults-grid input:checked")).map(i=>i.value);if(!e||!t||n.length===0||o.length===0){alert("Please fill all fields and select at least one system and fault.");return}const s=document.getElementById("builder-equipment").dataset.editingId;if(s){const i=d.findIndex(a=>a.id===s);i!==-1&&(d[i]={...d[i],equipment:e,section:t,systems:n,faults:o})}else d.push({id:Date.now().toString(),equipment:e,section:t,systems:n,faults:o});alert(`Relation ${s?"updated":"created"} successfully`),Y(),f(),q(),j("manager"),g()}function Y(){document.getElementById("builder-equipment").value="",document.getElementById("builder-section").value="",document.querySelectorAll(".systems-grid input, .faults-grid input").forEach(e=>e.checked=!1),delete document.getElementById("builder-equipment").dataset.editingId,w()}function $e(e){document.getElementById("builder-equipment").value=e.equipment,document.getElementById("builder-section").value=e.section,document.querySelectorAll(".systems-grid input, .faults-grid input").forEach(t=>t.checked=!1),e.systems.forEach(t=>{const n=document.querySelector(`.systems-grid input[value="${t}"]`);n&&(n.checked=!0)}),e.faults.forEach(t=>{const n=document.querySelector(`.faults-grid input[value="${t}"]`);n&&(n.checked=!0)}),document.getElementById("builder-equipment").dataset.editingId=e.id,w()}function Me(e){const t=d.find(n=>n.id===e);t&&($e(t),j("builder"))}function Fe(e){confirm("Are you sure you want to delete this relation?")&&(d=d.filter(t=>t.id!==e),f(),q(),g())}function Ne(){Y(),j("builder")}function De(){const e=document.getElementById("custom-system"),t=se();if(t){const n=document.querySelector(`.systems-grid input[value="${t}"]`);n&&(n.checked=!0),w()}e.value=""}function Re(){const e=document.getElementById("custom-fault"),t=ae();if(t){const n=document.querySelector(`.faults-grid input[value="${t}"]`);n&&(n.checked=!0),w()}e.value=""}function Oe(){const t=JSON.stringify({equipmentList:m,systemTypes:v,faultTypes:E,equipmentRelations:d,sections:r,bookings:y},null,2),n=new Blob([t],{type:"application/json"}),o=document.createElement("a");o.href=URL.createObjectURL(n),o.download="equipment-utilization-data.json",o.click(),URL.revokeObjectURL(o.href)}function He(){const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=t=>{const n=t.target.files[0];if(!n)return;const o=new FileReader;o.onload=s=>{try{const i=JSON.parse(s.target.result);confirm("This will replace all current data. Are you sure?")&&(Ge(i),alert("Data imported successfully!"))}catch(i){alert("Error reading file: "+i.message)}},o.readAsText(n)},e.click()}function B(){let e=document.getElementById("meeting-timeline");if(!e.querySelector("#meeting-equipment-rows")){const o=document.createElement("div");o.id="meeting-equipment-rows",o.className="equipment-rows",e.appendChild(o)}S("meeting-equipment-rows",!1);const t=document.getElementById("meeting-equipment-rows"),n=e.querySelector(".no-bookings-message");if(n&&n.remove(),y.length===0){const o=document.createElement("p");o.className="no-bookings-message",o.style.textAlign="center",o.style.padding="20px",o.textContent="No bookings to display.",e.insertBefore(o,t);return}}function Pe(e,t){const n=e.timeBlocks.map(l=>l.index);if(n.length===0)return;const o=Math.min(...n),s=Math.max(...n)-o+1,i=document.createElement("div");i.className="booking-summary",i.style.left=`${o*6}px`,i.style.width=`${s*6}px`,i.style.backgroundColor=Z(e.section),i.dataset.bookingId=e.id;const a=e.section.charAt(0).toUpperCase()+e.section.slice(1);i.innerHTML=`<div class="booking-summary-title">${a}</div><div>${e.comments||""}</div>`,i.title=`Time: ${e.startTime}-${_(e.endTime)}
Fault: ${e.fault}
Comments: ${e.comments||"None"}`,i.addEventListener("click",()=>ce(e.id)),t.appendChild(i)}function je(){const e=document.getElementById("meeting-timeline");e&&ue(e,{useCORS:!0,allowTaint:!0,scale:2}).then(t=>{const n=document.createElement("a");n.download=`meeting-overview-${new Date().toISOString().split("T")[0]}.jpg`,n.href=t.toDataURL("image/jpeg",.9),n.click()}).catch(t=>{console.error("Error exporting as JPG:",t),alert("Could not export the meeting view. Please check the console for errors.")})}function Ue(){if(y.length===0){alert("No bookings to export.");return}const e=[...y].sort((s,i)=>s.startTime.localeCompare(i.startTime));let t=`Morning Meeting Overview

`;e.forEach((s,i)=>{const a=m.find(l=>l.toLowerCase().replace(/\s+/g,"-")===s.equipment)||s.equipment;t+=`Booking #${i+1}: ${a} - ${s.startTime} to ${_(s.endTime)}
`,t+=`System: ${s.system}
Responsible: ${s.section}
Fault: ${s.fault}
Comments: ${s.comments||"None"}

`});const n=new Blob([t],{type:"text/plain;charset=utf-8"}),o=document.createElement("a");o.href=URL.createObjectURL(n),o.download=`meeting-overview-${new Date().toISOString().split("T")[0]}.txt`,o.click(),URL.revokeObjectURL(o.href)}function Ve(){y.length===0||!confirm("Are you sure you want to clear all bookings? This cannot be undone.")||(y=[],S("equipment-rows",!0),B(),g(),alert("All bookings have been cleared."))}function re(){if(p.length===0)return;const e=[...p].sort((n,o)=>n.time.localeCompare(o.time)),t=m.find(n=>n.toLowerCase().replace(/\s+/g,"-")===k)||k;document.getElementById("selected-equipment").textContent=t,document.getElementById("start-time").textContent=e[0].time,document.getElementById("end-time").textContent=_(e[e.length-1].time),document.getElementById("selection-info").style.display="block"}function me(){document.getElementById("selection-info").style.display="none"}function Z(e){const t=r.find(n=>n.name===e);return t?t.color:"#ddd"}function _(e){if(!e)return"";const[t,n]=e.split(":").map(Number),o=new Date(0,0,0,t,n+5);return`${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}`}function Ge(e){m=e.equipmentList||[],v=e.systemTypes||[],E=e.faultTypes||[],d=e.equipmentRelations||[],r=e.sections||[],y=e.bookings||[],S("equipment-rows",!0),$(),A(),I(),M(),f(),q(),B(),g()}
